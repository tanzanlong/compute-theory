## Zab与Paxos

### Zab只是Paxos的特殊实现吗？

不，Zab与Paxos是不同的协议，虽然它与它共享一些关键方面，例如：

- 领导者向追随者提出价值观
- 在考虑提交的提案之前，领导者等待法定人数的答复（学习）
- 建议包括与Paxos中的选票数量类似的epoch数字

Zab和Paxos之间的主要概念区别在于它主要为Zookeeper等主要备份系统设计，而不是用于状态机复制。

### 主从复制和状态机复制有什么区别？

状态机是处理一系列请求的软件组件。对于每个处理的请求，它可以修改其内部状态并产生回复。状态机是确定性的，在给定两次运行的情况下，它接收到相同的请求序列，它总是进行相同的内部状态转换并产生相同的回复。

状态机复制系统是一个客户端服务器系统，可确保每个状态机副本执行相同的**客户端请求**序列，即使这些请求是由客户端并发提交并由副本按不同顺序接收的。副本使用像Paxos这样的共识算法就客户端请求的执行顺序达成一致。并发发送并且时间重叠的客户请求可以以任何顺序执行。如果领导者失败，执行恢复的新领导者可以自由地对任何未提交的请求重新排序，因为它尚未完成。

对于主备备份系统（如Zookeeper），副本同意**增量（增量）状态更新**的应用顺序，**增量状态更新**由主副本生成并发送给其追随者。与客户端请求不同，状态更新必须从主服务器的初始初始状态开始，以主服务器的确切初始生成顺序应用。如果主节点发生故障，执行恢复的新主节点不能任意重新排序未提交的状态更新，或者从不同的初始状态开始应用它们。

总之，关于状态更新的协议（对于主备备份系统）需要比客户端请求（针对状态机复制系统）的协议更严格的命令保证。

### 协议算法的含义是什么？

通过让主服务器成为领导者，Paxos可用于主备备份。Paxos的问题在于，如果主*并发地*提出多个状态更新并且失败，则新的主可能以不正确的顺序应用未提交的更新。我们的[DSN 2011年论文中](https://pdfs.semanticscholar.org/fc11/031895c302dc52404d34de58af1a72f3b817.pdf)提供了一个示例（图1）。在这个例子中，一个副本应该只应用了A之后的状态更新B.这个例子表明，使用Paxos，一个新的主要及其后续可以在C之后应用B，达到一个不正确的状态，这个状态没有被任何一个以前的初选。

使用Paxos解决此问题的一个解决方法是*依次*达成状态更新：主要提交状态更新，仅在它提交所有以前的状态更新之后。由于一次最多只有一个未提交的更新，因此新的主要更新不能错误地重新排序。但是，这种方法导致性能较差。

Zab不需要这种解决方法。Zab副本可以在不损害正确性的情况下同时对多个状态更新的顺序达成一致。与Paxos相比，恢复过程中增加了一个同步阶段，并通过使用基于zxids的不同编号的实例来实现。